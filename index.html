<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>五笔词库管理</title>
    <link rel="stylesheet" href="./scss/wubi.css">
    <link rel="stylesheet" href="node_modules/vue-virtual-scroller/dist/vue-virtual-scroller.css">
<!--    <script src="node_modules/vue/dist/vue.esm.browser.min.js"></script>-->
</head>
<body>

<div v-cloak id="app">
    <div class="search-bar" v-if="dict">
        <div class="btn btn-primary" @click="resetInputs">重置</div>
        <input class="word" ref="domInputWord" v-model="word" type="text" placeholder="词条">
        <input class="code" ref="domInputCode" v-model="code" type="text" placeholder="编码">
        <div class="btn btn-primary" @click="addNewPhrase">添加</div>
        <div class="btn btn-cyan" ref="domBtnSave" @click="saveDictToFile">{{ labelOfSaveBtn }}</div>
        <div class="btn btn-primary" @click="search">搜索</div>
        <div class="btn btn-roseo" v-show="selectedWordIds.length > 0" @click="deleteWords">删除</div>
        <div class="btn btn-blue" v-show="selectedWordIds.length > 0" @click="addToMain">添加到主码表</div>
    </div>

    <div ref="container"
         :style="`height: ${heightContent}px`"
         class="container">
        <!--  normal-mode-->
        <div class="list-container" v-if="!dict.isGroupMode">
            <div class="group">
                <recycle-scroller
                    :buffer="1000"
                    :prerender="200"
                    :style="`height: ${heightContent}px`"
                    v-if="dict.words"
                    :min-item-size="26"
                    class="virtual-list"
                    :items="dict.words">
                    <template v-slot="{ item, index }">
                        <div class="word-item">
                            <div class="checkbox-cell">
                                <input
                                    v-model="selectedWordIds"
                                    name="table"
                                    :id="`word${index}`"
                                    type="checkbox"
                                    :value="item.id">
                                <label class="checkbox" :for="`word${index}`"></label>
                            </div>
                            <div class="code">{{ item.code }}</div>
                            <div class="word">{{ item.word }}</div>
                            <div class="id">{{ item.id }}</div>
                            <div class="operation">
                                <div class="up" @click="moveUp(item.id)">
                                    <img src="./assets/up.svg" alt="move up">
                                </div>
                                <div class="down" @click="moveDown(item.id)">
                                    <img src="./assets/down.svg" alt="move down">
                                </div>
                            </div>
                        </div>
                    </template>
                </recycle-scroller>
            </div>
        </div>

        <!-- group-mode-->
        <div class="list-container"
             :style="`height: ${heightContent}px`"
             v-else>
            <div class="group" v-for="(group, groupIndex) in dict.words" :key="groupIndex">
                <div :class="['group-header', {active: activeGroupId === groupIndex}]"
                     @click.right="group.isEditingTitle = !group.isEditingTitle">
                    <input v-model="group.groupName"
                           v-if="group.isEditingTitle"
                           @keydown.enter="group.isEditingTitle = false" />
                    <h3
                        v-else
                        @click="activeGroupId = groupIndex"
                    >{{ group.groupName }}</h3>
                </div>
                <div class="word-list">
                    <div class="word-item" v-for="(item, index) in group.dict" :key="item.id">
                        <div class="checkbox-cell">
                            <input
                                v-model="selectedWordIds"
                                name="selectedIds"
                                :id="`${groupIndex}-${index}`"
                                type="checkbox"
                                :value="item.id">
                            <label class="checkbox" :for="`${groupIndex}-${index}`"></label>
                        </div>
                        <div class="code">{{ item.code }}</div>
                        <div class="word">{{ item.word }}</div>
                        <div class="id">{{ item.id }}</div>
                        <div class="operation">
                            <div class="up" @click="moveUp(item.id)">
                                <img src="./assets/up.svg" alt="move up">
                            </div>
                            <div  class="down" @click="moveDown(item.id)">
                                <img src="./assets/down.svg" alt="move down">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!--FOOTER-->
    <div class="footer">
        <div class="footer-toolbar">
            <div class="link-list">
                <div class="link" @click="openCurrentYaml">打开源文件</div>
                <div class="link" ref="domBtnSelectAll" @click="selectAll">全选</div>
            </div>
            <div class="info-list">
                <div class="count" v-if="this.dict.isGroupMode"><span>分组模式</span></div>
                <div class="count">总 <span class="number">{{dict.countDictOrigin}}</span></div>
                <div class="count"
                     v-if="dict.countDictOrigin !== dict.countDict">显 <span class="number">{{dict.countDict}}</span></div>
                <div class="count">选 <span class="number">{{selectedWordIds.length}}</span></div>
            </div>
        </div>

        <div class="display">{{display}}</div>
    </div>
</div>

<script type="module" src="js/App.mjs"></script>
</body>
</html>